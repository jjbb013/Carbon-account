name: éª‘è½¦+ç­”é¢˜+å›æ”¶ 3 in 1

on:
  schedule:
    - cron: '1 4 * * 1-5'  # UTCæ—¶é—´4:01ï¼Œå³åŒ—äº¬æ—¶é—´12:01
  workflow_dispatch:

jobs:
  carbon-tasks:
    runs-on: ubuntu-latest
    env:
      # å„ä»»åŠ¡APIè®¾ç½®
      BIKE_URL: https://carbon-account-server.carbonstop.net/task/complete
      BIKE_BODY: '{"value":1,"sceneCode":"MRCJ1888","signMessage":"cb5632e24c8f83b157c910d6bb2bd525"}'
      
      QUESTION_URL: https://carbon-account-server.carbonstop.net/question/submit
      QUESTION_BODY: '[{"answerA":"åˆç†ä¿è¯å°±æ˜¯ä¿è¯æ•°æ®æ˜¯ç»å¯¹å‡†ç¡®çš„  ","correctAnswer":"A","updateTime":"2022-07-15 18:59:16","answerB":"åˆç†ä¿è¯è¯´æ˜æ•°æ®æ˜¯ç›¸å¯¹å‡†ç¡®å’Œå¯ä»¥ä¿¡èµ–çš„","questionTitle":"å…³äºä¿è¯ç­‰çº§è¯´æ³•ä¸æ­£ç¡®çš„æ˜¯","answerC":"ä»»ä½•ç»„ç»‡çš„æ¸©å®¤æ°”ä½“æ ¸æŸ¥éƒ½å¯è¦æ±‚ä½œæœ‰é™ä¿è¯çš„è¯„å®¡","answerNum":0,"questionLabels":["001"],"delFlag":0,"answerD":"æœ‰é™ä¿è¯å¯¹æ•°æ®çš„å®Œæ•´æ€§åšæœ‰é™åº¦çš„è¯„å®¡  ","id":351,"delFlag_name":"æ­£å¸¸","questionType_name":"å•é€‰","createBy":0,"questionType":1,"answerE":null,"updateBy":0,"questionType_name_format":"å•é€‰","answerF":null,"createTime":"2022-07-15 18:54:26","answerG":null},{"answerA":"å›½é™…æ’æ”¾å› å­","correctAnswer":"B","updateTime":"2022-07-15 19:04:26","answerB":"ç›¸åŒå·¥è‰º\/è®¾å¤‡çš„ç»éªŒç³»æ•°è·å¾—çš„æ’æ”¾å› å­","questionTitle":"åœ¨æ ¸æŸ¥è¿‡ç¨‹ä¸­å¸¸ç”¨æ’æ”¾å› å­æ³•æ¥è®¡ç®—æ¸©å®¤æ°”ä½“æ’æ”¾é‡ï¼Œä»¥ä¸‹4ç±»æ’æ”¾å› å­ä¸­ï¼Œæ•°æ®è´¨é‡è¾ƒé«˜çš„æ˜¯ï¼ˆ ï¼‰","answerC":"åŒºåŸŸæ’æ”¾å› å­","answerNum":0,"questionLabels":["001"],"delFlag":0,"answerD":"è®¾å¤‡åˆ¶é€ å•†æä¾›çš„ç³»æ•°è·å¾—çš„æ’æ”¾å› å­","id":316,"delFlag_name":"æ­£å¸¸","questionType_name":"å•é€‰","createBy":0,"questionType":1,"answerE":null,"updateBy":0,"questionType_name_format":"å•é€‰","answerF":null,"createTime":"2022-07-15 18:54:26","answerG":null},{"answerA":"å®¶ç”¨å†°ç®±è¿è¡Œ3å¤©","correctAnswer":"C","updateTime":"2022-07-15 18:54:26","answerB":"æ™®é€šç”µè§†æœºæŒç»­å¼€1å¤©","questionTitle":"1åº¦ç”µç›¸å½“äº(   ):","answerC":"25ç“¦çš„ç¯æ³¡èƒ½è¿ç»­ç‚¹äº®40å°æ—¶","answerNum":0,"questionLabels":["001"],"delFlag":0,"answerD":"å°†20å…¬æ–¤çš„æ°´çƒ§å¼€","id":406,"delFlag_name":"æ­£å¸¸","questionType_name":"å•é€‰","createBy":0,"questionType":1,"answerE":null,"updateBy":0,"questionType_name_format":"å•é€‰","answerF":null,"createTime":"2022-07-15 18:54:26","answerG":null},{"answerA":"èµ„æº","correctAnswer":"A","updateTime":"2022-07-15 18:54:26","answerB":"æ±¡æŸ“","questionTitle":"é€šå¸¸è®¤ä¸ºåƒåœ¾æ˜¯æ”¾é”™äº†åœ°æ–¹çš„__________ã€‚","answerC":"åºŸç‰©","answerNum":0,"questionLabels":["001"],"delFlag":0,"answerD":null,"id":107,"delFlag_name":"æ­£å¸¸","questionType_name":"å•é€‰","createBy":0,"questionType":1,"answerE":null,"updateBy":0,"questionType_name_format":"å•é€‰","answerF":null,"createTime":"2022-07-15 18:54:26","answerG":null},{"answerA":"è§£å†³å¥½ç»æµå¢é•¿â€”â€”èƒ½æºæ¶ˆè´¹â€”â€”GHGå‡æ’çš„ä¸‰è§’å…³ç³»","correctAnswer":"A,B,C","updateTime":"2022-07-15 19:02:41","answerB":"è°ƒæ•´èƒ½æºæ¶ˆè´¹ç»“æ„çš„åŒæ—¶ä¿éšœèƒ½æºä¾›åº”","questionTitle":"å®ç°â€30Â·60â€ç›®æ ‡éœ€è¦ç›´é¢çš„ä¸‰å¤§éš¾é¢˜","answerC":"ç¯å¢ƒæ²»ç†ä¸å‡æ’ä¸èƒ½ç»™å¤§ä¼—å¸¦æ¥æ²‰é‡çš„ç»æµè´Ÿæ‹…","answerNum":0,"questionLabels":["001"],"delFlag":0,"answerD":null,"id":550,"delFlag_name":"æ­£å¸¸","questionType_name":"å¤šé€‰","createBy":0,"questionType":2,"answerE":null,"updateBy":0,"questionType_name_format":"å¤šé€‰","answerF":null,"createTime":"2022-07-15 18:54:26","answerG":null}]'
      
      BOX_URL: https://carbon-account-server.carbonstop.net/task/complete
      BOX_BODY: '{"sceneCode":"MRCJ1889","value":1,"signMessage":"38173cda070782f86b6c2b3e92192156"}'
    
    steps:
      - name: æ£€å‡ºä»£ç åº“
        uses: actions/checkout@v4
        
      - name: å®‰è£…å¿…è¦å·¥å…·
        run: sudo apt-get -qq install jq
        
      - name: æ£€æŸ¥é…ç½®æ–‡ä»¶
        run: |
          if [ ! -f "user-configs.json" ]; then
            echo "::error::é…ç½®æ–‡ä»¶ user-configs.json ä¸å­˜åœ¨ï¼"
            exit 1
          else
            echo "âœ… æ‰¾åˆ°é…ç½®æ–‡ä»¶ user-configs.json"
            echo "ğŸ“‹ ç”¨æˆ·åˆ—è¡¨:"
            jq -r 'keys[]' user-configs.json
          fi
        
      - name: æ‰§è¡Œéª‘è½¦ä»»åŠ¡ (1æ¬¡)
        run: |
          #!/bin/bash
          echo "ğŸš´ å¼€å§‹éª‘è½¦ä»»åŠ¡ (1æ¬¡æ‰§è¡Œ)"
          echo "â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„"
          
          while IFS='=' read -r user token; do
            echo "ğŸ”„ å¤„ç†ç”¨æˆ·: $user"
            
            # æ£€æŸ¥tokenæ˜¯å¦ä¸ºç©º
            if [ -z "$token" ] || [ "$token" = "null" ]; then
              echo "âš ï¸ è­¦å‘Š: $user çš„appTokenä¸ºç©ºæˆ–æœªè®¾ç½®"
              continue
            fi
            
            # æ‰§è¡Œéª‘è½¦è¯·æ±‚
            echo "ğŸ” è¯·æ±‚è¯¦æƒ…:"
            #echo "  URL: $BIKE_URL"
            #echo "  Token: $token"
            #echo "  Body: $BIKE_BODY"
            
            curl -s -w "\n" -X POST \
              -H "Content-Type: application/json" \
              -H "Authorization: $token" \
              -d "$BIKE_BODY" \
              $BIKE_URL
              
            echo  # æ·»åŠ ç©ºè¡Œ
          done < <(jq -r 'to_entries[] | "\(.key)=\(.value.appToken)"' user-configs.json)
          
          echo "ğŸ éª‘è½¦ä»»åŠ¡å®Œæˆ"
        
      - name: æ‰§è¡Œç­”é¢˜ä»»åŠ¡ (2æ¬¡)
        run: |
          #!/bin/bash
          function execute_questions() {
            local round=$1
            echo "â¡ï¸ ç­”é¢˜ä»»åŠ¡ç¬¬${round}è½®å¼€å§‹"
            
            while IFS='=' read -r user token; do
              echo "â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„"
              echo "ğŸ”„ å¤„ç†ç”¨æˆ·: $user"
              
              # æ£€æŸ¥tokenæ˜¯å¦ä¸ºç©º
              if [ -z "$token" ] || [ "$token" = "null" ]; then
                echo "âš ï¸ è­¦å‘Š: $user çš„appTokenä¸ºç©ºæˆ–æœªè®¾ç½®"
                continue
              fi
              
              # æ‰§è¡Œç­”é¢˜è¯·æ±‚
              echo "ğŸ” è¯·æ±‚è¯¦æƒ…:"
              #echo "  URL: $QUESTION_URL"
              #echo "  Token: $token"
              #echo "  Body: $QUESTION_BODY"
              
              curl -s -w "\n" -X POST \
                -H "Content-Type: application/json" \
                -H "Authorization: $token" \
                -d "$QUESTION_BODY" \
                $QUESTION_URL
                
              echo  # æ·»åŠ ç©ºè¡Œ
              sleep 1  # ç”¨æˆ·é—´çŸ­æš‚é—´éš”
            done < <(jq -r 'to_entries[] | "\(.key)=\(.value.appToken)"' user-configs.json)
          }
          
          # ç¬¬ä¸€è½®ç­”é¢˜
          execute_questions 1
          
          # ç­‰å¾…10ç§’åè¿›è¡Œç¬¬äºŒè½®
          echo -e "\nğŸ•’ ç­‰å¾…10ç§’åè¿›è¡Œç¬¬äºŒè½®ç­”é¢˜...\n"
          sleep 10
          
          # ç¬¬äºŒè½®ç­”é¢˜
          execute_questions 2
          
          echo "ğŸ ç­”é¢˜ä»»åŠ¡å®Œæˆ"
        
      - name: æ‰§è¡Œå›æ”¶ä»»åŠ¡ (3æ¬¡)
        run: |
          #!/bin/bash
          function execute_box() {
            local round=$1
            echo "â™»ï¸ å›æ”¶ä»»åŠ¡ç¬¬${round}è½®å¼€å§‹"
            
            while IFS='=' read -r user token; do
              echo "â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„"
              echo "ğŸ”„ å¤„ç†ç”¨æˆ·: $user"
              
              # æ£€æŸ¥tokenæ˜¯å¦ä¸ºç©º
              if [ -z "$token" ] || [ "$token" = "null" ]; then
                echo "âš ï¸ è­¦å‘Š: $user çš„appTokenä¸ºç©ºæˆ–æœªè®¾ç½®"
                continue
              fi
              
              # æ‰§è¡Œå›æ”¶è¯·æ±‚
              echo "ğŸ” è¯·æ±‚è¯¦æƒ…:"
              #echo "  URL: $BOX_URL"
              #echo "  Token: $token"
              #echo "  Body: $BOX_BODY"
              
              curl -s -w "\n" -X POST \
                -H "Content-Type: application/json" \
                -H "Authorization: $token" \
                -d "$BOX_BODY" \
                $BOX_URL
                
              echo  # æ·»åŠ ç©ºè¡Œ
              sleep 1  # ç”¨æˆ·é—´çŸ­æš‚é—´éš”
            done < <(jq -r 'to_entries[] | "\(.key)=\(.value.appToken)"' user-configs.json)
          }
          
          # ç¬¬ä¸€è½®å›æ”¶
          execute_box 1
          
          # ç­‰å¾…10ç§’åè¿›è¡Œç¬¬äºŒè½®
          echo -e "\nğŸ•’ ç­‰å¾…10ç§’åè¿›è¡Œç¬¬äºŒè½®å›æ”¶...\n"
          sleep 10
          
          # ç¬¬äºŒè½®å›æ”¶
          execute_box 2
          
          # ç­‰å¾…10ç§’åè¿›è¡Œç¬¬ä¸‰è½®
          echo -e "\nğŸ•’ ç­‰å¾…10ç§’åè¿›è¡Œç¬¬ä¸‰è½®å›æ”¶...\n"
          sleep 10
          
          # ç¬¬ä¸‰è½®å›æ”¶
          execute_box 3
          
          echo "ğŸ å›æ”¶ä»»åŠ¡å®Œæˆ"
